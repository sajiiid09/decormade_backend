generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  CUSTOMER
}

model User {
  id             String        @id // Clerk user ID (no default, set from Clerk)
  email          String        @unique
  password       String?
  firstName      String?
  lastName       String?
  phone          String?
  role           UserRole      @default(CUSTOMER)
  isActive       Boolean       @default(true)
  preferences    Json?
  profilePicture String?
  googleId       String?       @unique
  loginCount     Int           @default(0)
  lastLogin      DateTime?
  addresses      UserAddress[]
  reviews        Review[]
  orders         Order[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model UserAddress {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  label     String?
  type      String?
  phone     String?
  isDefault Boolean  @default(false)
  data      Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id            String      @id @default(cuid())
  name          String
  description   String?
  category      String?
  price         Decimal     
  stock         Int         @default(0)
  images        Json?
  isActive      Boolean     @default(true)
  isFeatured    Boolean     @default(false)
  ratingAverage Float       @default(0)
  ratingCount   Int         @default(0)
  reviews       Review[]
  orderItems    OrderItem[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Review {
  id        String   @id @default(cuid())
  rating    Int
  comment   String?
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id                 String      @id @default(cuid())
  orderNumber        String      @unique
  status             String      @default("pending")
  paymentStatus      String      @default("pending")
  paymentMethod      String?
  paymentTransaction String?
  shippingAddress    Json?
  billingAddress     Json?
  subtotal           Decimal     
  shippingCost       Decimal     
  tax                Decimal     
  total              Decimal     
  trackingNumber     String?
  carrier            String?
  estimatedDelivery  DateTime?
  deliveredAt        DateTime?
  cancelledAt        DateTime?
  cancellationReason String?
  customerNote       String?
  adminNote          String?
  user               User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId             String
  items              OrderItem[]
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
}

model OrderItem {
  id        String   @id @default(cuid())
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String
  product   Product  @relation(fields: [productId], references: [id])
  productId String
  quantity  Int
  price     Decimal  
  total     Decimal  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
